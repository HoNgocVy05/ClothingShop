<% 
    const prod = product || {
        id: null,
        name: 'Không tìm được thông tin sản phẩm',
        images: [],
        price: 0,
        final_price: 0,
        description: '',
        stock_s: 0,
        stock_m: 0,
        stock_l: 0,
        stock_xl: 0
    };
%>

<div class="product-infor-page">
    <div class="product-wrapper">
        <!-- Hình ảnh sản phẩm -->
        <div class="product-image">
            <div class="main-img">
                <img id="mainImage" src="<%= product.images && product.images[0] ? '/uploads/products/' + product.images[0] : '/images/img-product-default.png' %>" alt="<%= product.name %>" />
            </div>
            <div class="thumbnails">
                <% if (prod.images && prod.images.length > 0) { %>
                    <% prod.images.forEach(img => { %>
                        <img class="thumbnails-img" src="/uploads/products/<%= img %>" alt="Thumb" onclick="changeMainImage(this)" />
                    <% }) %>
                <% } %>
            </div>
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="product-info-page">
            <div id="productData"
                 data-id="<%= prod.id %>"
                 data-stock-s="<%= Number(prod.stock_s || 0) %>"
                 data-stock-m="<%= Number(prod.stock_m || 0) %>"
                 data-stock-l="<%= Number(prod.stock_l || 0) %>"
                 data-stock-xl="<%= Number(prod.stock_xl || 0) %>">
            </div>

            <h1 class="product-title"><%= prod.name %></h1>

            <div class="product-price">
                 <% if (product.discount_percent > 0) { %>
                    <p class="discount-price"><%= Number(prod.final_price || prod.price).toLocaleString() %>đ</p>
                    <p class="origin-price"><%= Number(prod.price || 0).toLocaleString() %>đ</p>
                <% } else { %>
                    <p class="origin-price nodis"><%= Number(prod.price || 0).toLocaleString() %>đ</p>
                <% } %>
            </div>

            <hr class="price-divider" />

            <!-- Chọn size -->
            <div class="size-options">
                <label>Size</label>
                <div class="size-list">
                    <% const S_disabled  = prod.stock_s  <= 0; %>
                    <% const M_disabled  = prod.stock_m  <= 0; %>
                    <% const L_disabled  = prod.stock_l  <= 0; %>
                    <% const XL_disabled = prod.stock_xl <= 0; %>
                    <button 
                        class="size-btn <%= S_disabled ? 'disabled' : '' %> <%= !S_disabled ? 'selected' : '' %>"
                        <%= S_disabled ? 'disabled' : '' %> onclick="<%= S_disabled ? '' : 'selectSize(this)' %>">
                        S
                    </button>
                    <button 
                        class="size-btn <%= M_disabled ? 'disabled' : '' %>"
                        <%= M_disabled ? 'disabled' : '' %>  onclick="<%= M_disabled ? '' : 'selectSize(this)' %>">
                        M
                    </button>
                    <button 
                        class="size-btn <%= L_disabled ? 'disabled' : '' %>"
                        <%= L_disabled ? 'disabled' : '' %>  onclick="<%= L_disabled ? '' : 'selectSize(this)' %>">
                        L
                    </button>
                    <button 
                        class="size-btn <%= XL_disabled ? 'disabled' : '' %>"
                        <%= XL_disabled ? 'disabled' : '' %> onclick="<%= XL_disabled ? '' : 'selectSize(this)' %>">
                        XL
                    </button>
                </div>

            </div>

            <!-- Số lượng -->
            <div class="quantity">
                <label>Số lượng</label>
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick=" changeProductQuantity(-1)">-</button>
                    <input type="text" class="quantity-input" value="1" id="quantity" readonly />
                    <button class="quantity-btn" onclick=" changeProductQuantity(1)">+</button>
                    <span class="stock-info">
                        (còn <%= Number(prod.stock_s + prod.stock_m + prod.stock_l + prod.stock_xl || 0) %> sản phẩm)
                    </span>
                </div>
            </div>

            <!-- Nút hành động -->
            <div class="actions">
                <button class="btn btn-cart"
                    id="addToCart"
                    data-id="<%= prod.id %>"
                    data-name="<%= prod.name %>"
                    data-price="<%= prod.price %>"
                    data-image="<%= prod.image %>">
                    <i class="fa-solid fa-cart-shopping cart-icon"></i>
                    Thêm vào giỏ hàng
                </button>
                <button class="btn btn-buy" id="buyNow">MUA NGAY</button>
            </div>
        </div>
    </div>

    <!-- MÔ TẢ SẢN PHẨM -->
    <div class="dropdown-box">
        <div class="dropdown-description" onclick="toggleDropdown('desc')">
            <div class="icon-text">
                <i class="fa-solid fa-circle-exclamation"></i>
                Mô tả sản phẩm
                <span class="arrow">▼</span>
            </div>
        </div>

        <div class="dropdown-content" id="desc">
            <%= prod.description %>
        </div>
    </div>

    <!-- GIAO HÀNG -->
    <div class="dropdown-box">
        <div class="dropdown-shipping" onclick="toggleDropdown('shipping')">
            <div class="icon-text">
                <i class="fa-solid fa-truck-fast truck-icon"></i>
                Thời gian nhận hàng
                <span class="arrow">▼</span>
            </div>
        </div>

        <div class="dropdown-content" id="shipping">
            <b>TIÊU CHUẨN:</b> 10-15 ngày<br />
            Không bao gồm thời gian xử lý hải quan 7-10 ngày.
            <br /><br />
            Thời gian giao hàng được tính trong ngày làm việc chỉ dành cho khu vực thành phố lớn và chỉ là ước tính.
            Thời gian vận chuyển do các hãng chuyển phát cung cấp và có thể thay đổi tùy thuộc vào địa điểm và điều kiện bên ngoài.
            <br /><br />
            Trong thời gian bán hàng, vui lòng cho phép thêm thời gian.
            Không giao hàng đến hộp thư Bưu điện hoặc Tủ đựng Bưu kiện.
        </div>
    </div>
</div>
<script>
    window.PRODUCT = {
        id: "<%= prod.id %>",
        stock_s: Number("<%= prod.stock_s %>"),
        stock_m: Number("<%= prod.stock_m %>"),
        stock_l: Number("<%= prod.stock_l %>"),
        stock_xl: Number("<%= prod.stock_xl %>")
    };
</script>
