<% 
    const saleIds = saleProducts
        ? saleProducts.filter(p => p.discount_percent > 0).map(p => p.id)
        : [];
%>

<!-- Carousel -->
<div class="swiper">
    <div class="swiper-wrapper">
        <div class="swiper-slide"><img src="images/banner1.png" alt="banner1"></div>
        <div class="swiper-slide"><img src="images/banner2.png" alt="banner2"></div>
        <div class="swiper-slide"><img src="images/banner3.png" alt="banner3"></div>
    </div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-pagination"></div>
</div>

<!-- SALE -->
<div class="tag">
    <a href="#" class="sale-tag">SALE UP TO 50%</a>
</div>
<div class="sale-container">
    <i class="fa-solid fa-angle-left sale-nav-btn"></i>
    <div class="sale product-container">
        <% saleProducts && saleProducts .filter(p => p.discount_percent > 0) .slice(0, 10) .forEach((product) => { %>

            <div class="product-card<%= product.discount_percent == 0 ? ' nodiscount' : '' %>" onclick="window.location.href='/product-infomation?id=<%= product.id %>'">
                <div class="card-img">
                    <img src="<%= product.images && product.images[0] ? '/uploads/products/' + product.images[0] : '/images/img-product-default.png' %>" alt="<%= product.name %>">
                </div>
                <div class="product-info">
                    <a href="/product-infomation?id=<%= product.id %>" class="product-name"><%= product.name %></a>
                    <div class="product-price">
                        <p class="discount-price"><%= formatPrice(product.final_price) %>đ</p>
                        <p class="origin-price"><%= formatPrice(product.price) %>đ</p>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
    <i class="fa-solid fa-angle-right sale-nav-btn"></i>
</div>

<!-- catalog -->
<% categoriesWithProducts && categoriesWithProducts.forEach((category) => { %>
<div class="tag-group">
    <div class="tag">
        <a href="/product-list?category=<%= category.id %>" class="catalog-tag"><%= category.name %></a>
    </div>
    <div class="tag-child">
        <% category.children && category.children.forEach((child) => { %>
            <a href="/product-list?category=<%= child.id %>" class="tag-item"><%= child.name %></a>
        <% }) %>
    </div>
</div>

<div class="product-container">
    <% category.products && category.products .filter(p => !saleIds.includes(p.id)) .slice(0, 10) .forEach((product) => { %>
        <div class="product-card<%= product.discount_percent == 0 ? ' nodiscount' : '' %>" onclick="window.location.href='/product-infomation?id=<%= product.id %>'">
            <div class="card-img">
                <img src="<%= product.images && product.images[0] ? '/uploads/products/' + product.images[0] : '/images/shirt.png' %>" alt="<%= product.name %>">
            </div>
            <div class="product-info">
                <a href="/product-infomation?id=<%= product.id %>" class="product-name"><%= product.name %></a>
                <div class="product-price">
                    <% if (product.discount_percent > 0) { %>
                        <p class="discount-price"><%= formatPrice(product.final_price) %>đ</p>
                        <p class="origin-price"><%= formatPrice(product.price) %>đ</p>
                    <% } else { %>
                        <p class="discount-price" style="display:none"></p>
                        <p class="origin-price nodis"><%= formatPrice(product.price) %>đ</p>
                    <% } %>
                </div>
            </div>
        </div>
    <% }) %>
</div>
<% }) %>

<script>
(() => {
    const container = document.querySelector('.sale.product-container');
    const btnLeft = document.querySelector('.fa-angle-left');
    const btnRight = document.querySelector('.fa-angle-right');

    if (!container || !btnLeft || !btnRight) return;

    const getCardWidth = () => {
        const card = container.querySelector('.product-card');
        return card ? card.offsetWidth + 30 : 200;
    };

    const scroll = (distance) => {
        container.scrollBy({ left: distance, behavior: 'smooth' });
    };

    btnRight.addEventListener('click', () => scroll(getCardWidth()));
    btnLeft.addEventListener('click', () => scroll(-getCardWidth()));
})();
</script>
